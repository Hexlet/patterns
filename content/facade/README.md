# Facade (Фасад)

Фасад - наружная, лицевая сторона здания.

### Проблематика

    +--------------+    +--------------------------------+
    |              |    |                                |
    |              |    |  +--------------------------+  |
    |              +------->                          |  |
    |              |    |  |                          |  |
    |              |    |  +--------------------------+  |
    |              |    |                                |
    |              |    |                                |
    |              |    |  +--------------------------+  |
    |    Client    +------->                          |  |
    |              |    |  |                          |  |
    |              |    |  +--------------------------+  |
    |              |    |                                |
    |              |    |                                |
    |              |    |  +--------------------------+  |
    |              +------->                          |  |
    |              |    |  |                          |  |
    |              |    |  +--------------------------+  |
    |              |    |                                |
    +--------------+    +--------------------------------+

Подсистема (не обязательно код), с которой работает клиент, имеет множество компонентов. Клиент, по необходимости, обращается к каждому из компонентов. К таким подсистемам можно отнести:

* HTTP API, в котором множество независимых входных точек;
* Библиотека (Пакет) предоставляющая множество классов. Например AWS SDK.

Возможных проблем тут две. Одна со стороны клиента, другая со стороны подсистемы.

#### Подсистема

Если клиент знает про модули подсистемы и обращается к ним напрямую, то разработчики подсистемы не могут менять ее структуру. Удаление компонента или перераспределение ответственностей между ними (что может повлечь за собой изменение их количества) приведут к нарушению обратной совместимости. То есть клиентский код просто перестанет работать, так как он ожидал одного поведения, а получил либо другое, либо вообще отсутствие поведения.

#### Клиент

Для клиента, не составляет большого труда работать с разными компонентами одной подсистемы. Главное неудобство заключается в необходимости знать больше деталей, например, то как обратиться к компоненту или где находится его документация и так далее.

### Решение

Решение состоит в том, чтобы создать единую точку входа, через которую клиент получает доступ к подсистемам. Такую точку входа называют "Фасад".

                                               +--------------+           +--------------------------------+
                                               |              |           |                                |
                                               |              |           |  +--------------------------+  |
                                               |              +-------------->  Subsystem 1             |  |
                                               |              |           |  |                          |  |
                                               |              |           |  +--------------------------+  |
    +---------------------+                    |              |           |                                |
    |                     |                    |              |           |                                |
    |                     |                    |              |           |  +--------------------------+  |
    |       Client        +-------------------->    Facade    +-------------->  Subsystem 2             |  |
    |                     |                    |              |           |  |                          |  |
    |                     |                    |              |           |  +--------------------------+  |
    +---------------------+                    |              |           |                                |
                                               |              |           |                                |
                                               |              |           |  +--------------------------+  |
                                               |              +-------------->  Subsystem 3             |  |
                                               |              |           |  |                          |  |
                                               |              |           |  +--------------------------+  |
                                               |              |           |                                |
                                               +--------------+           +--------------------------------+

Типичный пример использования фасада - входная точка в библиотеках распространяемых через пакетные менеджеры соответствующих языков. Возьмем для примера AWS SDK. В двух словах, AWS - набор из большого количества разнородных сервисов (базы данных, очереди, виртуальные машины, отправка почты), у каждого из которых есть свой собственный API для управления. Для работы с AWS сервисами из JavaScript создана специальная библиотека (SDK) https://github.com/aws/aws-sdk-js. Для каждого сервиса внутри библиотеки реализован собственный набор классов. Например, для взаимодействия с сервисом S3 нужно написать такой код:

```javascript
import S3 from 'aws-sdk/clients/s3';

const s3 = new S3();
// ...
```

А для взаимодействия с EC2 такой:

```javascript
import EC2 from 'aws-sdk/clients/ec2';

const ec2 = new EC2();
// ...
```

Здесь мы видим прямое обращение к сервисам. В каждом импорте зашит путь до конкретного файла внутри библиотеки. А теперь посмотрим как можно получить к ним доступ используя фасад:


```javascript
import AWS from 'aws-sdk';

const s3 = new AWS.S3();
const ec2 = new AWS.EC2();
// ...
```

Такой код не завязан на внутреннюю структуру библиотеки и нам не нужно знать про пути до конкретных классов. Библиотека, в свою очередь, может измениться так, что поменяется место хранения соответствующих классов, но на клиентском коде это не отразится. Последнее, правда, актуально только в том случае, если доступ без использования фасада не считается официально поддерживаемым. В любом случае, чисто технически, вы всегда можете обойти фасад и пойти напрямую. Запретить прямые вызовы невозможно, но делать так не стоит.

Фасад не скрывает существование компонентов. Мы знаем что работаем либо с S3, либо с EC2. Другими словами, через фасад мы получаем доступ до компонента, но работаем с компонентом напрямую.

На уровне языка фасад может быть представлен практически чем угодно - хоть структурой данных, хоть функцией, хоть классом. Все зависит от ситуации.

### Влияние

+ Повышает модульность. Клиентский код знает меньше деталей реализации.
+ Облегачает рефакторинг. Если клиентский код взаимодействует только с фасадом, то всегда остается возможность изменить внутреннюю структуру кода.

### Реализации

* javascript
    * [Модуль](javascript/module)
